<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú©ÙˆÛŒÛŒØ² Ø³Ø§Ø² Ù‡ÙˆØ´Ù…Ù†Ø¯</title>
    <style>
        body { font-family: 'Tahoma', sans-serif; background-color: #f0f2f5; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .card { background: white; padding: 2rem; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 90%; max-width: 500px; text-align: center; }
        h1 { color: #333; font-size: 1.5rem; margin-bottom: 20px; }
        input { width: 80%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-family: inherit; font-size: 1rem; outline: none; }
        input:focus { border-color: #007bff; }
        button#create-btn { margin-top: 15px; padding: 12px 25px; background-color: #007bff; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; transition: 0.3s; width: 100%; }
        button#create-btn:hover { background-color: #0056b3; }
        button#create-btn:disabled { background-color: #ccc; cursor: not-allowed; }
        
        /* Ø¨Ø®Ø´ Ù†Ù…Ø§ÛŒØ´ Ø³ÙˆØ§Ù„ */
        #quiz-container { margin-top: 30px; display: none; text-align: right; }
        .question-text { font-weight: bold; font-size: 1.1rem; margin-bottom: 15px; color: #222; }
        .options-grid { display: grid; gap: 10px; }
        .option-btn { padding: 15px; border: 2px solid #e0e0e0; background: #fff; border-radius: 8px; cursor: pointer; text-align: right; transition: 0.2s; font-family: inherit; font-size: 0.95rem; }
        .option-btn:hover { background-color: #f9f9f9; border-color: #bbb; }
        
        /* Ú©Ù„Ø§Ø³â€ŒÙ‡Ø§ÛŒ Ø±Ù†Ú¯ÛŒ Ø¨Ø±Ø§ÛŒ Ø¬ÙˆØ§Ø¨ */
        .correct { background-color: #d4edda !important; border-color: #28a745 !important; color: #155724; }
        .wrong { background-color: #f8d7da !important; border-color: #dc3545 !important; color: #721c24; }
        
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #007bff; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 20px auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="card">
    <h1>ðŸ¤– Ú©ÙˆÛŒÛŒØ² Ø³Ø§Ø² Ù‡ÙˆØ´Ù…Ù†Ø¯</h1>
    <p style="color:#666; font-size:0.9rem;">Ù…ÙˆØ¶ÙˆØ¹ Ø¯Ù„Ø®ÙˆØ§Ù‡Øª Ø±Ùˆ Ø¨Ù†ÙˆÛŒØ³ ØªØ§ Ø¨Ø±Ø§Øª Ø³ÙˆØ§Ù„ Ø¨Ø³Ø§Ø²Ù…!</p>
    
    <input type="text" id="topic-input" placeholder="Ù…Ø«Ù„Ø§: Ù¾Ø§ÛŒØªØ®Øªâ€ŒÙ‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†ØŒ ÙÙˆØªØ¨Ø§Ù„ØŒ Ø³ÛŒÙ†Ù…Ø§...">
    <button id="create-btn" onclick="getQuiz()">Ø³Ø§Ø®Øª Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯</button>
    
    <div class="loader" id="loader"></div>

    <div id="quiz-container">
        <p class="question-text" id="question">ØµÙˆØ±Øª Ø³ÙˆØ§Ù„ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ù…ÛŒâ€ŒÚ¯ÛŒØ±Ø¯ØŸ</p>
        <div class="options-grid" id="options-box">
            <!-- Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯ -->
        </div>
    </div>
</div>

<script>
    let currentCorrectIndex = -1;

    async function getQuiz() {
        const topic = document.getElementById('topic-input').value;
        if (!topic) return alert("Ù„Ø·ÙØ§ ÛŒÚ© Ù…ÙˆØ¶ÙˆØ¹ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯");

        // Ø­Ø§Ù„Øª Ù„ÙˆØ¯ÛŒÙ†Ú¯
        document.getElementById('create-btn').disabled = true;
        document.getElementById('create-btn').innerText = "Ø¯Ø± Ø­Ø§Ù„ ÙÚ©Ø± Ú©Ø±Ø¯Ù†...";
        document.getElementById('loader').style.display = 'block';
        document.getElementById('quiz-container').style.display = 'none';

        try {
            const response = await fetch('/generate_quiz', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ topic: topic })
            });

            const data = await response.json();

            if (data.error) {
                alert(data.error);
            } else {
                showQuestion(data);
            }

        } catch (error) {
            alert("Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯. Ù„Ø·ÙØ§ Ø¯ÙˆØ¨Ø§Ø±Ù‡ ØªÙ„Ø§Ø´ Ú©Ù†ÛŒØ¯.");
        } finally {
            document.getElementById('create-btn').disabled = false;
            document.getElementById('create-btn').innerText = "Ø³Ø§Ø®Øª Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯";
            document.getElementById('loader').style.display = 'none';
        }
    }

    function showQuestion(data) {
        document.getElementById('question').innerText = data.question;
        const optionsBox = document.getElementById('options-box');
        optionsBox.innerHTML = ''; // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ
        currentCorrectIndex = data.correct_index;

        data.options.forEach((opt, index) => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            btn.innerText = opt;
            btn.onclick = () => checkAnswer(btn, index);
            optionsBox.appendChild(btn);
        });

        document.getElementById('quiz-container').style.display = 'block';
    }

    function checkAnswer(btn, index) {
        // ØºÛŒØ±ÙØ¹Ø§Ù„ Ú©Ø±Ø¯Ù† Ù‡Ù…Ù‡ Ø¯Ú©Ù…Ù‡â€ŒÙ‡Ø§ Ø¨Ø¹Ø¯ Ø§Ø² Ø§Ù†ØªØ®Ø§Ø¨
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(b => b.disabled = true);

        if (index === currentCorrectIndex) {
            btn.classList.add('correct');
        } else {
            btn.classList.add('wrong');
            // Ù†Ø´Ø§Ù† Ø¯Ø§Ø¯Ù† Ø¬ÙˆØ§Ø¨ Ø¯Ø±Ø³Øª
            allBtns[currentCorrectIndex].classList.add('correct');
        }
    }
</script>

</body>
</html>